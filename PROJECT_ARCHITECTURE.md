# UpScale App Project Architecture

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯UpScale Appãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ãŠã‚ˆã³å‡¦ç†ãƒ•ãƒ­ãƒ¼ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
UpScaleAppProject/
â”œâ”€â”€ ğŸ“„ ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ simple_gui.py          # ãƒ¡ã‚¤ãƒ³GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ simple_convert.py      # åŸºæœ¬å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆ  
â”‚   â”œâ”€â”€ main.py               # ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ç‰ˆãƒ¡ã‚¤ãƒ³
â”‚   â””â”€â”€ main_gui.py           # GUIç‰ˆãƒ¡ã‚¤ãƒ³
â”‚
â”œâ”€â”€ ğŸ”§ è¨­å®šãƒ»ç’°å¢ƒ
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ settings.py       # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
â”‚   â”œâ”€â”€ setup_environment.py  # ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â”œâ”€â”€ install_dependencies.py # ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
â”‚   â””â”€â”€ requirements*.txt     # ä¾å­˜é–¢ä¿‚å®šç¾©
â”‚
â”œâ”€â”€ ğŸ¯ ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (src/)
â”‚   â”œâ”€â”€ gui/                  # GUI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ main_window.py    # ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
â”‚   â”‚   â”œâ”€â”€ batch_window.py   # ãƒãƒƒãƒå‡¦ç†ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
â”‚   â”‚   â”œâ”€â”€ preview_window.py # ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
â”‚   â”‚   â””â”€â”€ plugin_manager_window.py # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ modules/              # å‡¦ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ video_processor.py    # å‹•ç”»å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”‚   â”œâ”€â”€ video_builder.py      # å‹•ç”»å†æ§‹ç¯‰
â”‚   â”‚   â”œâ”€â”€ waifu2x_processor.py  # Waifu2xçµ±åˆ
â”‚   â”‚   â”œâ”€â”€ amd_waifu2x_backend.py # AMD GPUå¯¾å¿œ
â”‚   â”‚   â”œâ”€â”€ batch_processor.py    # ãƒãƒƒãƒå‡¦ç†
â”‚   â”‚   â”œâ”€â”€ ai_processor.py       # AIå‡¦ç†çµ±åˆ
â”‚   â”‚   â””â”€â”€ settings_manager.py   # è¨­å®šç®¡ç†
â”‚   â”‚
â”‚   â””â”€â”€ plugins/              # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
â”‚       â””â”€â”€ plugin_system.py # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç†
â”‚
â”œâ”€â”€ ğŸ“Š å‡ºåŠ›ãƒ»ãƒ­ã‚°
â”‚   â”œâ”€â”€ output/              # å‡¦ç†æ¸ˆã¿å‹•ç”»å‡ºåŠ›
â”‚   â”œâ”€â”€ logs/               # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°
â”‚   â””â”€â”€ temp/               # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒç­‰ï¼‰
â”‚
â””â”€â”€ ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ README.md           # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
    â”œâ”€â”€ CHANGELOG.md        # å¤‰æ›´å±¥æ­´
    â””â”€â”€ docs/              # è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

## ğŸš€ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[ãƒ¦ãƒ¼ã‚¶ãƒ¼èµ·å‹•] --> B{èµ·å‹•æ–¹æ³•é¸æŠ}
    B -->|GUI| C[simple_gui.py]
    B -->|CLI| D[simple_convert.py]
    
    C --> E[ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ]
    D --> E
    
    E --> F[å‹•ç”»åˆ†æ]
    F --> G[å‡¦ç†è¨­å®š]
    G --> H{å‡¦ç†æ–¹å¼é¸æŠ}
    
    H -->|Waifu2x| I[Waifu2xå‡¦ç†]
    H -->|Simple| J[ç°¡å˜å‡¦ç†]
    
    I --> K[ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º]
    J --> K
    
    K --> L[ãƒ•ãƒ¬ãƒ¼ãƒ å‡¦ç†]
    L --> M[å‹•ç”»å†æ§‹ç¯‰]
    M --> N[éŸ³å£°åˆæˆ]
    N --> O[å‡ºåŠ›å®Œäº†]
    
    L -.->|ã‚­ãƒ£ãƒ³ã‚»ãƒ«| P[ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†]
    M -.->|ã‚­ãƒ£ãƒ³ã‚»ãƒ«| P
    N -.->|ã‚­ãƒ£ãƒ³ã‚»ãƒ«| P
```

## ğŸ¨ GUI ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
graph LR
    subgraph "GUI Layer"
        A[simple_gui.py<br/>ãƒ¡ã‚¤ãƒ³GUI]
        B[main_window.py<br/>ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦]
        C[batch_window.py<br/>ãƒãƒƒãƒå‡¦ç†]
        D[preview_window.py<br/>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼]
    end
    
    subgraph "Processing Layer"
        E[video_processor.py<br/>å‹•ç”»å‡¦ç†]
        F[waifu2x_processor.py<br/>AIå‡¦ç†]
        G[batch_processor.py<br/>ãƒãƒƒãƒå‡¦ç†]
    end
    
    subgraph "Core Layer"
        H[video_builder.py<br/>å‹•ç”»æ§‹ç¯‰]
        I[settings_manager.py<br/>è¨­å®šç®¡ç†]
        J[plugin_system.py<br/>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³]
    end
    
    A --> E
    B --> E
    C --> G
    D --> E
    
    E --> H
    F --> H
    G --> H
    
    E --> I
    F --> I
    G --> I
    
    H --> J
```

## âš™ï¸ å‹•ç”»å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant GUI as simple_gui.py
    participant VP as video_processor.py
    participant WP as waifu2x_processor.py
    participant VB as video_builder.py
    
    U->>GUI: å‹•ç”»é¸æŠ
    GUI->>VP: å‹•ç”»åˆ†æé–‹å§‹
    VP->>GUI: å‹•ç”»æƒ…å ±è¿”å´
    
    U->>GUI: å‡¦ç†é–‹å§‹
    GUI->>VP: ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡ºé–‹å§‹
    VP->>VP: ãƒ•ãƒ¬ãƒ¼ãƒ ä¿å­˜
    
    VP->>WP: ãƒ•ãƒ¬ãƒ¼ãƒ å‡¦ç†é–‹å§‹
    loop å„ãƒ•ãƒ¬ãƒ¼ãƒ 
        WP->>WP: AI upscaling
        WP->>GUI: é€²æ—æ›´æ–°
    end
    
    WP->>VB: å‡¦ç†æ¸ˆã¿ãƒ•ãƒ¬ãƒ¼ãƒ 
    VB->>VB: å‹•ç”»å†æ§‹ç¯‰
    VB->>VB: éŸ³å£°åˆæˆ
    VB->>GUI: å®Œäº†é€šçŸ¥
    GUI->>U: å‡¦ç†å®Œäº†
```

## ğŸ”§ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ä¾å­˜é–¢ä¿‚

```mermaid
graph TB
    subgraph "UI Layer"
        A[simple_gui.py]
        B[GUI Components]
    end
    
    subgraph "Business Logic"
        C[video_processor.py]
        D[waifu2x_processor.py]
        E[batch_processor.py]
    end
    
    subgraph "Core Services"
        F[video_builder.py]
        G[settings_manager.py]
        H[ai_processor.py]
    end
    
    subgraph "External Dependencies"
        I[FFmpeg]
        J[OpenCV]
        K[Waifu2x-ncnn-vulkan]
    end
    
    A --> C
    A --> E
    B --> C
    B --> D
    
    C --> F
    C --> G
    D --> H
    E --> C
    E --> F
    
    F --> I
    C --> J
    H --> K
    D --> K
```

## ğŸ“‹ ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

### 1. simple_gui.py - ãƒ¡ã‚¤ãƒ³GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- **å½¹å‰²**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ãƒ¡ã‚¤ãƒ³åˆ¶å¾¡
- **ä¸»ãªæ©Ÿèƒ½**:
  - ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ»å‹•ç”»åˆ†æ
  - å‡¦ç†è¨­å®šUIï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã€å“è³ªç­‰ï¼‰
  - é€²æ—è¡¨ç¤ºã¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†
  - FFmpeg/Waifu2xãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

### 2. video_processor.py - å‹•ç”»å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³
- **å½¹å‰²**: å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†æãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º
- **ä¸»ãªæ©Ÿèƒ½**:
  - å‹•ç”»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—
  - ãƒ•ãƒ¬ãƒ¼ãƒ å˜ä½ã§ã®åˆ†è§£ãƒ»ä¿å­˜
  - å‡¦ç†é€²æ—ç®¡ç†

### 3. waifu2x_processor.py - AIå‡¦ç†çµ±åˆ
- **å½¹å‰²**: Waifu2x AIãƒ¢ãƒ‡ãƒ«ã¨ã®çµ±åˆ
- **ä¸»ãªæ©Ÿèƒ½**:
  - è¤‡æ•°ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å¯¾å¿œï¼ˆNCNN-Vulkanç­‰ï¼‰
  - ãƒ•ãƒ¬ãƒ¼ãƒ å˜ä½ã§ã®é«˜å“è³ªã‚¢ãƒƒãƒ—ã‚¹ã‚±ãƒ¼ãƒ«
  - GPUå‡¦ç†æœ€é©åŒ–

### 4. video_builder.py - å‹•ç”»å†æ§‹ç¯‰
- **å½¹å‰²**: å‡¦ç†æ¸ˆã¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰ã®å‹•ç”»å†æ§‹ç¯‰
- **ä¸»ãªæ©Ÿèƒ½**:
  - ãƒ•ãƒ¬ãƒ¼ãƒ çµåˆãƒ»å‹•ç”»ç”Ÿæˆ
  - éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ä¿æŒãƒ»åŒæœŸ
  - FFmpegçµ±åˆã¨ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†

### 5. AMD GPUå¯¾å¿œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤
- **amd_gpu_detector.py**: AMD GPUæ¤œå‡º
- **amd_waifu2x_backend.py**: AMDç”¨Waifu2xãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **amd_vulkan_waifu2x.py**: Vulkanæœ€é©åŒ–å®Ÿè£…

## ğŸ”„ å‡¦ç†ãƒ•ã‚§ãƒ¼ã‚ºã¨çŠ¶æ…‹ç®¡ç†

```mermaid
stateDiagram-v2
    [*] --> åˆæœŸåŒ–
    åˆæœŸåŒ– --> ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
    ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ --> å‹•ç”»åˆ†æ
    å‹•ç”»åˆ†æ --> è¨­å®šèª¿æ•´
    è¨­å®šèª¿æ•´ --> å‡¦ç†æº–å‚™
    
    å‡¦ç†æº–å‚™ --> ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º
    ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º --> AIå‡¦ç†
    AIå‡¦ç† --> å‹•ç”»å†æ§‹ç¯‰
    å‹•ç”»å†æ§‹ç¯‰ --> éŸ³å£°åˆæˆ
    éŸ³å£°åˆæˆ --> å®Œäº†
    
    AIå‡¦ç† --> ã‚­ãƒ£ãƒ³ã‚»ãƒ« : ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
    å‹•ç”»å†æ§‹ç¯‰ --> ã‚­ãƒ£ãƒ³ã‚»ãƒ« : ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
    éŸ³å£°åˆæˆ --> ã‚­ãƒ£ãƒ³ã‚»ãƒ« : ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
    
    ã‚­ãƒ£ãƒ³ã‚»ãƒ« --> ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— --> ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
    å®Œäº† --> ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
```

## ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†

### ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†æ©Ÿèƒ½
- **subprocess.Popen()**: ãƒ—ãƒ­ã‚»ã‚¹IDä¿æŒã«ã‚ˆã‚‹é©åˆ‡ãªåˆ¶å¾¡
- **ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã«ã‚ˆã‚‹ã„ã¤ã§ã‚‚ä¸­æ–­å¯èƒ½
- **ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†**: Windows/Unixå¯¾å¿œã®å¼·åˆ¶çµ‚äº†å‡¦ç†
- **ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†**: ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ¡ãƒ¢ãƒªã®é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

### ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ•ãƒ­ãƒ¼
```mermaid
graph TD
    A[å‡¦ç†é–‹å§‹] --> B{ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼Ÿ}
    B -->|No| C[æ­£å¸¸å‡¦ç†ç¶™ç¶š]
    B -->|Yes| D[ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ]
    
    D --> E{ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥}
    E -->|ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼| F[ãƒ•ã‚¡ã‚¤ãƒ«å¾©æ—§è©¦è¡Œ]
    E -->|ãƒ—ãƒ­ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼| G[ãƒ—ãƒ­ã‚»ã‚¹å¼·åˆ¶çµ‚äº†]
    E -->|ãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼| H[ãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—]
    
    F --> I[ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥]
    G --> I
    H --> I
    
    I --> J[å®‰å…¨ãªçŠ¶æ…‹ã«å¾©å¸°]
```

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§ä¿å®ˆæ€§ã®é«˜ã„å‹•ç”»ã‚¢ãƒƒãƒ—ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ç‹¬ç«‹æ€§ã‚’ä¿ã¡ãªãŒã‚‰ã€åŠ¹ç‡çš„ãªå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹æˆã—ã¦ã„ã¾ã™ã€‚